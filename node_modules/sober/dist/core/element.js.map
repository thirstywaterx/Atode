{
  "version": 3,
  "sources": ["element.js"],
  "sourcesContent": ["export const supports = { CSSStyleSheet: true, CSSContainer: CSS.supports('container-type', 'size') };\ntry {\n    new CSSStyleSheet();\n}\ncatch (error) {\n    supports.CSSStyleSheet = false;\n}\n//\u8BBE\u7F6E\u6837\u5F0F\nconst setStyle = (shadowRoot, cssStr) => {\n    for (const css of cssStr) {\n        if (!supports.CSSStyleSheet) {\n            const el = document.createElement('style');\n            el.textContent = css;\n            shadowRoot.insertBefore(el, shadowRoot.firstChild);\n            continue;\n        }\n        const sheet = new CSSStyleSheet();\n        sheet.replaceSync(css);\n        shadowRoot.adoptedStyleSheets = [...shadowRoot.adoptedStyleSheets, sheet];\n    }\n};\nexport const useProps = (options) => {\n    const props = {};\n    const meta = {};\n    for (const key in options) {\n        let value = options[key];\n        const state = { key: key, sync: true, types: [] };\n        if (key.startsWith('$')) {\n            state.key = key.slice(1);\n            state.sync = false;\n        }\n        if (Array.isArray(value)) {\n            state.types = value;\n            value = state.types[0];\n        }\n        props[state.key] = value;\n        meta[state.key] = {\n            sync: state.sync,\n            def: value,\n            to: (v) => {\n                switch (typeof value) {\n                    case 'string':\n                        const val = String(v);\n                        return state.types.length > 0 ? (state.types.includes(val) ? val : state.types[0]) : val;\n                    case 'number':\n                        const num = Number(v);\n                        return isNaN(num) ? value : num;\n                    case 'boolean':\n                        return typeof v === 'boolean' ? v : v === 'true';\n                }\n            }\n        };\n    }\n    Object.defineProperty(props, '$meta', { value: meta });\n    return props;\n};\n//\u6CE8\u518C\u4E8B\u4EF6\nexport const useEvents = (options) => {\n    return options;\n};\nconst baseStyle = `:host{user-select:none;-webkit-user-select:none;-webkit-tap-highlight-color:transparent;outline:none}*{outline:none}`\n//\u6CE8\u518C\u7EC4\u4EF6\nexport const useElement = (options) => {\n    const state = {\n        observedAttributes: [],\n        upperPropKeys: {},\n        metaProps: options.props?.$meta ?? {},\n        events: []\n    };\n    for (const key in state.metaProps ?? {}) {\n        const value = key.toLowerCase();\n        state.observedAttributes.push(value);\n        state.upperPropKeys[value] = key;\n    }\n    for (const key in options.events) {\n        const k = `on${key}`;\n        state.observedAttributes.push(k);\n        if (k in HTMLElement.prototype)\n            continue;\n        state.events.push(k);\n    }\n    const map = new Map();\n    class Component extends HTMLElement {\n        static observedAttributes = state.observedAttributes;\n        static define(name) {\n            customElements.define(name, this);\n        }\n        constructor() {\n            super();\n            const shadowRoot = this.attachShadow({ mode: 'open' });\n            shadowRoot.innerHTML = options.template ?? '';\n            setStyle(shadowRoot, [baseStyle, ...options.style ? (Array.isArray(options.style) ? options.style : [options.style]) : []]);\n            const props = { ...options.props };\n            let setup;\n            const ahead = {};\n            for (const key in props) {\n                const initValue = this[key];\n                if (initValue !== undefined)\n                    ahead[key] = initValue;\n                Object.defineProperty(this, key, {\n                    configurable: true,\n                    get: () => {\n                        const call = setup?.[key];\n                        if (!call || typeof call === 'function' || !call.get)\n                            return props[key];\n                        return call.get?.(props[key]);\n                    },\n                    set: (v) => {\n                        const meta = state.metaProps[key];\n                        const value = v === undefined ? meta.def : meta.to(v);\n                        if (meta.sync) {\n                            const lowerKey = key.toLowerCase();\n                            const attrValue = this.getAttribute(lowerKey);\n                            const valueStr = String(value);\n                            if (value === meta.def && attrValue !== null)\n                                return this.removeAttribute(lowerKey);\n                            if (value !== meta.def && attrValue !== valueStr)\n                                return this.setAttribute(lowerKey, valueStr);\n                        }\n                        if (value === this[key])\n                            return;\n                        const old = props[key];\n                        props[key] = value;\n                        const call = setup?.[key];\n                        if (!call)\n                            return;\n                        try {\n                            typeof call === 'function' ? call(value, old) : call.set?.(value, old);\n                        }\n                        catch (error) {\n                            props[key] = old;\n                            throw error;\n                        }\n                    }\n                });\n            }\n            //\u81EA\u5B9A\u4E49\u4E8B\u4EF6\n            const customEvents = {};\n            for (const key of state.events) {\n                const k = key;\n                if (typeof this[k] === 'function') {\n                    customEvents[key] = this[k];\n                }\n                Object.defineProperty(this, key, {\n                    configurable: true,\n                    get: () => customEvents[key] ?? null,\n                    set: (v) => customEvents[key] = typeof v === 'function' ? v : undefined\n                });\n                this.addEventListener(key.slice(2), (event) => customEvents[key] && customEvents[key].bind(this)(event));\n            }\n            setup = options.setup?.call(this, shadowRoot);\n            // //\u5BFC\u51FAexpose\n            for (const key in setup?.expose ?? {})\n                Object.defineProperty(this, key, { get: () => setup?.expose?.[key] });\n            //\u91CD\u65B0\u8D4B\u503C\n            for (const key in ahead)\n                this[key] = ahead[key];\n            //@ts-ignore \u6E05\u9664\u751F\u547D\u5468\u671F\n            this.connectedCallback = this.disconnectedCallback = this.adoptedCallback = this.attributeChangedCallback = undefined;\n            map.set(this, setup);\n        }\n        connectedCallback() {\n            map.get(this)?.onMounted?.();\n        }\n        disconnectedCallback() {\n            map.get(this)?.onUnmounted?.();\n        }\n        adoptedCallback() {\n            map.get(this)?.onAdopted?.();\n        }\n        attributeChangedCallback(key, _, value) {\n            if (state.events.includes(key))\n                return this[key] = (value ? new Function('event', value) : null);\n            this[state.upperPropKeys[key]] = (value ?? undefined);\n        }\n    }\n    for (const key in options.methods) {\n        Component[key] = options.methods[key];\n    }\n    return Component;\n};\n"],
  "mappings": "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",
  "names": ["supports", "setStyle", "shadowRoot", "cssStr", "css", "el", "sheet", "useProps", "options", "props", "meta", "key", "value", "state", "v", "val", "num", "useEvents", "baseStyle", "useElement", "k", "map", "Component", "name", "setup", "ahead", "initValue", "call", "lowerKey", "attrValue", "valueStr", "old", "error", "customEvents", "event", "_"]
}
